
<!DOCTYPE html>
<html lang="zh" dir=ZgotmplZ>

<head>
  <meta name="generator" content="Hugo 0.124.1">
  
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Changelog Producer#流式写入可以持续产生最新变更，供流式读取使用。
通过在创建表时指定 changelog-producer 表属性，用户可以选择从表文件中产生变更的方式。
changelog-producer 可能会显著降低压缩性能，除非必要，请勿启用。None#默认情况下，表的写入端不会应用额外的变更日志（changelog）生成器。Paimon 源仅能看到跨快照合并后的变更，比如哪些键被删除，某些键的新值是什么。
然而，这些合并后的变更无法形成完整的变更日志，因为我们无法直接从中读取键的旧值。合并变更要求消费者“记住”每个键的值，并在看不到旧值的情况下重写新值。但有些消费者需要旧值来保证正确性或效率。
例如，有个消费者计算某些分组键（可能与主键不同）的求和。如果消费者只看到一个新值 5，它无法判断应该对求和结果加多少。如果旧值是 4，应加 1；如果旧值是 6，则应减 1。旧值对于这类消费者非常重要。
综上所述，none 类型的变更日志生成器最适合数据库系统等消费者。Flink 内置了一个“normalize”操作符，会将每个键的值保存在状态中。显而易见，这个操作符开销很大，应该避免使用。（你可以通过 &#39;scan.remove-normalize&#39; 强制移除该操作符。）
Input#通过指定 &#39;changelog-producer&#39; = &#39;input&#39;，Paimon 写入端依赖其输入作为完整变更日志的来源。所有输入记录都会被保存到独立的变更日志文件中，并由 Paimon 源提供给消费者。
当 Paimon 写入端的输入本身就是完整变更日志时（例如来自数据库 CDC，或由 Flink 有状态计算生成），可以使用 input 类型的变更日志生成器。
Lookup#如果你的输入无法生成完整的变更日志，但仍希望避免高开销的 normalize 操作符，可以考虑使用 &#39;lookup&#39; 类型的变更日志生成器。
通过指定 &#39;changelog-producer&#39; = &#39;lookup&#39;，Paimon 会在提交数据写入前，通过 &#39;lookup&#39; 方式生成变更日志。（你也可以启用 Async Compaction).
Lookup 会将数据缓存到内存和本地磁盘，你可以使用以下选项来调优性能：
OptionDefaultTypeDescriptionlookup.cache-file-retention1 hDuration用于 lookup 的缓存文件保留时间。文件过期后，如果仍需要访问，它将会从分布式文件系统（DFS）重新读取，并在本地磁盘上重建索引。lookup.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="变化日志生产者 Changelog Producer" />
<meta property="og:description" content="Changelog Producer#流式写入可以持续产生最新变更，供流式读取使用。
通过在创建表时指定 changelog-producer 表属性，用户可以选择从表文件中产生变更的方式。
changelog-producer 可能会显著降低压缩性能，除非必要，请勿启用。None#默认情况下，表的写入端不会应用额外的变更日志（changelog）生成器。Paimon 源仅能看到跨快照合并后的变更，比如哪些键被删除，某些键的新值是什么。
然而，这些合并后的变更无法形成完整的变更日志，因为我们无法直接从中读取键的旧值。合并变更要求消费者“记住”每个键的值，并在看不到旧值的情况下重写新值。但有些消费者需要旧值来保证正确性或效率。
例如，有个消费者计算某些分组键（可能与主键不同）的求和。如果消费者只看到一个新值 5，它无法判断应该对求和结果加多少。如果旧值是 4，应加 1；如果旧值是 6，则应减 1。旧值对于这类消费者非常重要。
综上所述，none 类型的变更日志生成器最适合数据库系统等消费者。Flink 内置了一个“normalize”操作符，会将每个键的值保存在状态中。显而易见，这个操作符开销很大，应该避免使用。（你可以通过 &#39;scan.remove-normalize&#39; 强制移除该操作符。）
Input#通过指定 &#39;changelog-producer&#39; = &#39;input&#39;，Paimon 写入端依赖其输入作为完整变更日志的来源。所有输入记录都会被保存到独立的变更日志文件中，并由 Paimon 源提供给消费者。
当 Paimon 写入端的输入本身就是完整变更日志时（例如来自数据库 CDC，或由 Flink 有状态计算生成），可以使用 input 类型的变更日志生成器。
Lookup#如果你的输入无法生成完整的变更日志，但仍希望避免高开销的 normalize 操作符，可以考虑使用 &#39;lookup&#39; 类型的变更日志生成器。
通过指定 &#39;changelog-producer&#39; = &#39;lookup&#39;，Paimon 会在提交数据写入前，通过 &#39;lookup&#39; 方式生成变更日志。（你也可以启用 Async Compaction).
Lookup 会将数据缓存到内存和本地磁盘，你可以使用以下选项来调优性能：
OptionDefaultTypeDescriptionlookup.cache-file-retention1 hDuration用于 lookup 的缓存文件保留时间。文件过期后，如果仍需要访问，它将会从分布式文件系统（DFS）重新读取，并在本地磁盘上重建索引。lookup." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lss1231.github.io/paimon-docs-chinese/primary-key-table/changelog-producer/" /><meta property="article:section" content="primary-key-table" />


<title>变化日志生产者 Changelog Producer | Paimon文档</title>
<link rel="manifest" href="/paimon-docs-chinese/manifest.json">
<link rel="icon" href="/paimon-docs-chinese/favicon.png" type="image/x-icon">
<link rel="alternate" hreflang="en" href="https://lss1231.github.io/paimon-docs-chinese/en/primary-key-table/changelog-producer/" title="Changelog Producer">

<link rel="stylesheet" href="/paimon-docs-chinese/book.min.b952fefba7a2e6dac79b3035a33b021d21a5f84843c9890ad9ab605f3bfe0eac.css" integrity="sha256-uVL&#43;&#43;6ei5trHmzA1ozsCHSGl&#43;EhDyYkK2atgXzv&#43;Dqw=">
<script defer src="/paimon-docs-chinese/zh.search.min.3035b225cd6619b0f5dab2b1ef9b4a916e841bd1df92a5c11299790084ad4cd2.js" integrity="sha256-MDWyJc1mGbD12rKx75tKkW6EG9HfkqXBEpl5AIStTNI="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
  

<link rel="stylesheet" type="text/css" href="https://lss1231.github.io/paimon-docs-chinese//font-awesome/css/font-awesome.min.css">
<script src="https://lss1231.github.io/paimon-docs-chinese//js/anchor.min.js"></script>
<script src="https://lss1231.github.io/paimon-docs-chinese//js/flink.js"></script>



  
  <script>
    var _paq = window._paq = window._paq || [];
     
     
    _paq.push(['disableCookies']);
     
    _paq.push(["setDomains", ["*.flink.apache.org","*.nightlies.apache.org/flink"]]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="//matomo.privacy.apache.org/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  
</head>

<body dir=ZgotmplZ>
  
    <input type="checkbox" class="hidden toggle" id="menu-control" />
    <input type="checkbox" class="hidden toggle" id="toc-control" />
  
  <main class="container flex">
    
      <aside class="book-menu">
        
  

<nav>


<a id="logo" href="https://lss1231.github.io/paimon-docs-chinese/">
    <img width="100%" src="https://lss1231.github.io/paimon-docs-chinese//paimon_black.svg">
</a>
<p style="text-align:right">1.2.0</p>

<div class="book-search">
  <input type="text" id="book-search-input" placeholder="搜索" aria-label="搜索" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>










  





  
  <ul>
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-c731eb3eada0765f704948e2d3b9bb48" class="toggle"  />
    <label for="section-c731eb3eada0765f704948e2d3b9bb48" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-book title maindish" aria-hidden="true"></i>&nbsp;&nbsp;概念 Concepts</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/overview/" class="">概述</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/basic-concepts/" class="">基础概念 Basic Concepts</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/concurrency-control/" class="">并发控制 Concurrency Control</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/catalog/" class="">Catalog</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-8451cf5dbd0ba165d2eff8eab794a5e2" class="toggle"  />
    <label for="section-8451cf5dbd0ba165d2eff8eab794a5e2" class="flex justify-between">RESTCatalog<span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/rest/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/rest/bear/" class="">Bear Token</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/rest/dlf/" class="">DLF Token</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/rest/rest-api/" class="">REST API</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/table-types/" class="">表类型 Table Types</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/system-tables/" class="">系统表 System Tables</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/data-types/" class="">数据类型 Data Types</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/functions/" class="">函数 Functions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-04b977f4d78c1a1179624ef9cf1c052f" class="toggle"  />
    <label for="section-04b977f4d78c1a1179624ef9cf1c052f" class="flex justify-between">规范说明 Specification<span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/spec/overview/" class="">概述 Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/spec/schema/" class="">模式文件 Schema</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/spec/snapshot/" class="">快照文件 Snapshot</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/spec/manifest/" class="">清单文件 Manifest</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/spec/datafile/" class="">数据文件 DataFile</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/spec/tableindex/" class="">表索引 Table Index</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/concepts/spec/fileindex/" class="">文件索引 File Index</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-13198e701ffb9c73ec7a3177a4f953f1" class="toggle" checked />
    <label for="section-13198e701ffb9c73ec7a3177a4f953f1" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-database title maindish" aria-hidden="true"></i>&nbsp;&nbsp;主键表 Table with PK</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/primary-key-table/overview/" class="">概览 Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/primary-key-table/data-distribution/" class="">数据分布 Data Distribution</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/primary-key-table/table-mode/" class="">表模式 Table Mode</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-f845a63b155c9d2fb0db740cc418eb68" class="toggle"  />
    <label for="section-f845a63b155c9d2fb0db740cc418eb68" class="flex justify-between">Merge Engine<span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/primary-key-table/merge-engine/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/primary-key-table/merge-engine/partial-update/" class="">Partial Update</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/primary-key-table/merge-engine/aggregation/" class="">Aggregation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/primary-key-table/merge-engine/first-row/" class="">First Row</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/primary-key-table/changelog-producer/" class=" active">变化日志生产者 Changelog Producer</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/primary-key-table/sequence-rowkind/" class="">Sequence 和 Rowkind</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/primary-key-table/compaction/" class="">合并 Compaction</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/primary-key-table/query-performance/" class="">查询性能 Query Performance</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-bb708993c18bd45422a8bcf87778bb93" class="toggle"  />
    <label for="section-bb708993c18bd45422a8bcf87778bb93" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-database title maindish" aria-hidden="true"></i>&nbsp;&nbsp;非主键表 Table w/o PK</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/append-table/overview/" class="">概览 Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/append-table/streaming/" class="">流 Streaming</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/append-table/query-performance/" class="">查询性能 Query Performance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/append-table/update/" class="">更新 Update</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/append-table/bucketed/" class="">分桶 Bucketed</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-23c9b577a4c36b65f28196976e8af8fd" class="toggle"  />
    <label for="section-23c9b577a4c36b65f28196976e8af8fd" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-gear title maindish" aria-hidden="true"></i>&nbsp;&nbsp;计算引擎 Flink Engine Flink</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/flink/quick-start/" class="">快速开始 Quick Start</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/flink/sql-ddl/" class="">SQL DDL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/flink/sql-write/" class="">SQL Write</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/flink/sql-query/" class="">SQL Query</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/flink/consumer-id/" class="">Consumer ID</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/flink/sql-lookup/" class="">SQL Lookup</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/flink/sql-alter/" class="">SQL Alter</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/flink/procedures/" class="">Procedures</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/flink/action-jars/" class="">Action Jars</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/flink/savepoint/" class="">Savepoint</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-86d841c4a4c551bb4e21d460836d4142" class="toggle"  />
    <label for="section-86d841c4a4c551bb4e21d460836d4142" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-gear title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Engine Spark</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/spark/quick-start/" class="">Quick Start</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/spark/sql-ddl/" class="">SQL DDL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/spark/sql-functions/" class="">SQL Functions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/spark/sql-write/" class="">SQL Write</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/spark/sql-query/" class="">SQL Query</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/spark/sql-alter/" class="">SQL Alter</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/spark/auxiliary/" class="">Auxiliary</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/spark/procedures/" class="">Procedures</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-30d29cf6aaa7fb1e0e056430337d3cd8" class="toggle"  />
    <label for="section-30d29cf6aaa7fb1e0e056430337d3cd8" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-gear title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Ecosystem</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/ecosystem/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/ecosystem/starrocks/" class="">StarRocks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/ecosystem/doris/" class="">Doris</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/ecosystem/hive/" class="">Hive</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/ecosystem/trino/" class="">Trino</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/ecosystem/amoro/" class="">Amoro</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-0d8ed5dd97c2657084dd792a5fb3dc39" class="toggle"  />
    <label for="section-0d8ed5dd97c2657084dd792a5fb3dc39" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-gear title maindish" aria-hidden="true"></i>&nbsp;&nbsp;CDC Ingestion</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/cdc-ingestion/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/cdc-ingestion/mysql-cdc/" class="">Mysql CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/cdc-ingestion/postgres-cdc/" class="">Postgres CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/cdc-ingestion/kafka-cdc/" class="">Kafka CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/cdc-ingestion/mongo-cdc/" class="">Mongo CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/cdc-ingestion/pulsar-cdc/" class="">Pulsar CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/cdc-ingestion/debezium-bson/" class="">Debezium BSON</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-572d5eb93948a39233efdc1aa454d415" class="toggle"  />
    <label for="section-572d5eb93948a39233efdc1aa454d415" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-wrench title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Maintenance</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/maintenance/filesystems/" class="">Filesystems</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/maintenance/write-performance/" class="">Write Performance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/maintenance/dedicated-compaction/" class="">Dedicated Compaction</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/maintenance/manage-snapshots/" class="">Manage Snapshots</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/maintenance/rescale-bucket/" class="">Rescale Bucket</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/maintenance/manage-tags/" class="">Manage Tags</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/maintenance/metrics/" class="">Metrics</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/maintenance/manage-privileges/" class="">Manage Privileges</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/maintenance/manage-branches/" class="">Manage Branches</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/maintenance/manage-partitions/" class="">Manage Partitions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/maintenance/configurations/" class="">Configurations</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-ffda0ff45a34e5f3ed8bf3826a7c8879" class="toggle"  />
    <label for="section-ffda0ff45a34e5f3ed8bf3826a7c8879" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-briefcase title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Program API</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/program-api/rest-api/" class="">REST API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/program-api/flink-api/" class="">Flink API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/program-api/java-api/" class="">Java API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/program-api/catalog-api/" class="">Catalog API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/program-api/python-api/" class="">Python API</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-3f8a436f48e29eeb422e6dd0a6e20e71" class="toggle"  />
    <label for="section-3f8a436f48e29eeb422e6dd0a6e20e71" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-briefcase title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Migration</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/migration/migration-from-hive/" class="">Migration From Hive</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/migration/migration-from-iceberg/" class="">Migration From Iceberg</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/migration/upsert-to-partitioned/" class="">Upsert To Partitioned</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/migration/clone-to-paimon/" class="">Clone To Paimon</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-3882ebcb06158ef11bac6340af15617a" class="toggle"  />
    <label for="section-3882ebcb06158ef11bac6340af15617a" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-briefcase title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Iceberg Metadata</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/iceberg/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/iceberg/append-table/" class="">Append Table</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/iceberg/primary-key-table/" class="">Primary Key Table</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/iceberg/iceberg-tags/" class="">Iceberg Tags</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/iceberg/hive-catalog/" class="">Hive Catalogs</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/iceberg/ecosystem/" class="">Ecosystem</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/iceberg/configurations/" class="">Configurations</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  	<br/>
  
  
    <input type="checkbox" id="section-fd0d6ee095aef42da7d15863a92a4aa0" class="toggle"  />
    <label for="section-fd0d6ee095aef42da7d15863a92a4aa0" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-sitemap title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Project</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/project/roadmap/" class="">Roadmap</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/project/download/" class="">Download</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/project/contributing/" class="">Contributing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/project/committer/" class="">Committer</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-9e09a206f89e5011227bdf8d37b7ee20" class="toggle"  />
    <label for="section-9e09a206f89e5011227bdf8d37b7ee20" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-sitemap title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Learn Paimon</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="https://lss1231.github.io/paimon-docs-chinese/learn-paimon/understand-files/" class="">Understand Files</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>
















<br/>
<hr class="menu-break">

<a href="//paimon.apache.org" style="color:black;margin-bottom:0.5em"><i class="link fa fa-external-link title" aria-hidden="true"></i> Project Homepage</a>
<br/>

<a href="//paimon.apache.org/docs/master/api/java/" style="color:black;margin-bottom:0.5em"><i class="link fa fa-external-link title" aria-hidden="true"></i> JavaDocs</a>
<br/>

<hr class="menu-break">
<li style="list-style-type: none">
  <br>
  <input type="checkbox" id="section-version-picker" class="toggle">
  <label for="section-version-picker" class="flex justify-between">
     <div style="font-weight:450;margin-bottom:0.5em">Pick Docs Version</div>
     <span>▾</span>
  </label>
  <ul>
    <a href="https://lss1231.github.io/paimon-docs-chinese/">
      1.2 (✓)
    </a>
    <hr class="menu-break">
    
      <li>
        <a href="https://paimon.apache.org/docs/master">
          master
        </a>
      </li>
    
      <li>
        <a href="https://paimon.apache.org/docs/1.2">
          stable
        </a>
      </li>
    
      <li>
        <a href="https://paimon.apache.org/docs/1.2">
          1.2
        </a>
      </li>
    
      <li>
        <a href="https://paimon.apache.org/docs/1.1">
          1.1
        </a>
      </li>
    
      <li>
        <a href="https://paimon.apache.org/docs/1.0">
          1.0
        </a>
      </li>
    
    <hr class="menu-break">
    <li>
      <a href="https://lss1231.github.io/paimon-docs-chinese//versions">
          All Versions
      </a>
    </li>
  </ul>
</li>




  

  


  





<a  href="https://lss1231.github.io/paimon-docs-chinese/en/primary-key-table/changelog-producer/" class="flex align-center">
  <i class="fa fa-globe" aria-hidden="true"></i>&nbsp;&nbsp;
  English
</a>



</nav>




  <script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </aside>
    

    <div class="book-page">
      
        <header class="book-header">
          
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/paimon-docs-chinese/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>变化日志生产者 Changelog Producer</strong>

  <label for="toc-control">
    
    <img src="/paimon-docs-chinese/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  

<nav id="TableOfContents"><h3>On This Page <button class="toc" onclick="collapseToc()"><i class="fa fa-compress" aria-hidden="true"></i></button></h3>
  <ul>
    <li><a href="#none">None</a></li>
    <li><a href="#input">Input</a></li>
    <li><a href="#lookup">Lookup</a></li>
    <li><a href="#full-compaction">Full Compaction</a></li>
    <li><a href="#changelog-merging">Changelog Merging</a></li>
  </ul>
</nav>


  </aside>
  
 
        </header>
      

      






      
  <article class="markdown"><!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<h1 id="changelog-producer">
  Changelog Producer
  <a class="anchor" href="#changelog-producer">#</a>
</h1>
<p>流式写入可以持续产生最新变更，供流式读取使用。</p>
<p>通过在创建表时指定 <code>changelog-producer</code> 表属性，用户可以选择从表文件中产生变更的方式。</p>
<blockquote class="book-hint info">
  <code>changelog-producer</code> 可能会显著降低压缩性能，除非必要，请勿启用。
</blockquote>

<h2 id="none">
  None
  <a class="anchor" href="#none">#</a>
</h2>
<p>默认情况下，表的写入端不会应用额外的变更日志（changelog）生成器。Paimon 源仅能看到跨快照合并后的变更，比如哪些键被删除，某些键的新值是什么。</p>
<p>然而，这些合并后的变更无法形成完整的变更日志，因为我们无法直接从中读取键的旧值。合并变更要求消费者“记住”每个键的值，并在看不到旧值的情况下重写新值。但有些消费者需要旧值来保证正确性或效率。</p>
<p>例如，有个消费者计算某些分组键（可能与主键不同）的求和。如果消费者只看到一个新值 <code>5</code>，它无法判断应该对求和结果加多少。如果旧值是 <code>4</code>，应加 1；如果旧值是 <code>6</code>，则应减 1。旧值对于这类消费者非常重要。</p>
<p>综上所述，<code>none</code> 类型的变更日志生成器最适合数据库系统等消费者。Flink 内置了一个“normalize”操作符，会将每个键的值保存在状态中。显而易见，这个操作符开销很大，应该避免使用。（你可以通过 <code>'scan.remove-normalize'</code> 强制移除该操作符。）</p>

<img 
  src="https://lss1231.github.io/paimon-docs-chinese//img/changelog-producer-none.png"
  alt=""
  width=""
  style="display:block;margin-left:auto;margin-right:auto"
>

<h2 id="input">
  Input
  <a class="anchor" href="#input">#</a>
</h2>
<p>通过指定 <code>'changelog-producer' = 'input'</code>，Paimon 写入端依赖其输入作为完整变更日志的来源。所有输入记录都会被保存到独立的变更日志文件中，并由 Paimon 源提供给消费者。</p>
<p>当 Paimon 写入端的输入本身就是完整变更日志时（例如来自数据库 CDC，或由 Flink 有状态计算生成），可以使用 <code>input</code> 类型的变更日志生成器。</p>

<img 
  src="https://lss1231.github.io/paimon-docs-chinese//img/changelog-producer-input.png"
  alt=""
  width=""
  style="display:block;margin-left:auto;margin-right:auto"
>

<h2 id="lookup">
  Lookup
  <a class="anchor" href="#lookup">#</a>
</h2>
<p>如果你的输入无法生成完整的变更日志，但仍希望避免高开销的 normalize 操作符，可以考虑使用 <code>'lookup'</code> 类型的变更日志生成器。</p>
<p>通过指定 <code>'changelog-producer' = 'lookup'</code>，Paimon 会在提交数据写入前，通过 <code>'lookup'</code> 方式生成变更日志。（你也可以启用 <a href="https://lss1231.github.io/paimon-docs-chinese/primary-key-table/compaction/#asynchronous-compaction">Async Compaction</a>).</p>

<img 
  src="https://lss1231.github.io/paimon-docs-chinese//img/changelog-producer-lookup.png"
  alt=""
  width=""
  style="display:block;margin-left:auto;margin-right:auto"
>

<p>Lookup 会将数据缓存到内存和本地磁盘，你可以使用以下选项来调优性能：</p>
<table class="table table-bordered">
    <thead>
    <tr>
      <th class="text-left" style="width: 20%">Option</th>
      <th class="text-left" style="width: 5%">Default</th>
      <th class="text-left" style="width: 10%">Type</th>
      <th class="text-left" style="width: 60%">Description</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td><h5>lookup.cache-file-retention</h5></td>
        <td style="word-wrap: break-word;">1 h</td>
        <td>Duration</td>
        <td>用于 lookup 的缓存文件保留时间。文件过期后，如果仍需要访问，它将会从分布式文件系统（DFS）重新读取，并在本地磁盘上重建索引。</td>
    </tr>
    <tr>
        <td><h5>lookup.cache-max-disk-size</h5></td>
        <td style="word-wrap: break-word;">unlimited</td>
        <td>MemorySize</td>
        <td>用于 lookup 缓存的本地磁盘最大使用空间。你可以使用此选项限制本地磁盘的使用量。</td>
    </tr>
    <tr>
        <td><h5>lookup.cache-max-memory-size</h5></td>
        <td style="word-wrap: break-word;">256 mb</td>
        <td>MemorySize</td>
        <td>用于 lookup 缓存的最大内存使用空间。</td>
    </tr>
    </tbody>
</table>
<p>Lookup 类型的 changelog-producer 支持 <code>changelog-producer.row-deduplicate</code> 参数，用于避免对同一条记录生成 <code>-U</code> 和 <code>+U</code> 类型的变更记录（即更新前和更新后的冗余变更日志）。</p>
<p><strong>注意：</strong> 请务必提升 Flink 配置项 <code>'execution.checkpointing.max-concurrent-checkpoints'</code> 的值，这对于提升性能非常重要。</p>
<h2 id="full-compaction">
  Full Compaction
  <a class="anchor" href="#full-compaction">#</a>
</h2>
<p>你也可以考虑使用 <code>'full-compaction'</code> 类型的 <code>changelog-producer</code> 来生成变更日志，该方式更适用于<strong>对延迟要求不高</strong>的场景（例如延迟在 30 分钟以上）。</p>
<ol>
<li>
<p>通过设置 <code>'changelog-producer' = 'full-compaction'</code>，Paimon 会在每次 full compaction 之后对比前后数据，生成变更日志。变更日志的延迟受 full compaction 触发频率影响。</p>
</li>
<li>
<p>配置 <code>full-compaction.delta-commits</code> 表属性后，可控制在多少个 delta commit（即 checkpoint）后触发一次 full compaction。默认值为 <code>1</code>，表示每个 checkpoint 都进行一次 full compaction，并生成 changelog。</p>
</li>
</ol>
<p>通常来说，<code>full compaction</code> 的计算成本和资源消耗都较高，因此<strong>更推荐使用 <code>'lookup'</code> 类型的 <code>changelog-producer</code></strong>。</p>
<p><code>lookup</code> 模式可以在提交数据前通过内存和本地磁盘缓存查找旧值，从而生成变更日志。它相比 <code>full-compaction</code> 更高效，适用于大多数对变更日志有需求的场景。</p>

<img 
  src="https://lss1231.github.io/paimon-docs-chinese//img/changelog-producer-full-compaction.png"
  alt=""
  width=""
  style="display:block;margin-left:auto;margin-right:auto"
>

<blockquote class="book-hint info">
  <code>full-compaction</code> 类型的 <code>changelog-producer</code> 可以为<strong>任意来源类型的写入数据</strong>生成完整的变更日志。
然而 相较于input changelog而言，<code>full-compaction</code>的效率比较低，而且延迟可能会也更高一些。
然而，相比 <code>input</code> 类型的 changelog producer，<code>full-compaction</code> 的效率较低，并且生成 changelog 的<strong>延迟可能较高</strong>。
</blockquote>

<p><code>full-compaction</code> 类型的 changelog producer 支持配置 <code>changelog-producer.row-deduplicate</code>，用于避免对同一条记录生成 <code>-U</code> 和 <code>+U</code> 类型的变更日志（changelog）。</p>
<h2 id="changelog-merging">
  Changelog Merging
  <a class="anchor" href="#changelog-merging">#</a>
</h2>
<p>对于 <code>input</code>、<code>lookup</code> 和 <code>full-compaction</code> 类型的 <code>changelog-producer</code>：</p>
<p>当 Flink 的 checkpoint 间隔较短（例如 30 秒），并且 bucket 数量较多时，每个 snapshot 可能会产生大量小的 changelog 文件。这些过多的小文件会给分布式存储系统带来压力。</p>
<p>为了解决这个问题，可以通过设置表属性 <code>precommit-compact = true</code> 来在写入完成后对 changelog 小文件进行预压缩（pre-commit compaction）。<br>
该选项默认为 <code>false</code>，若设置为 <code>true</code>，Paimon 会在 writer operator 后增加一个 compaction coordinator 和 worker operator，用于将 changelog 小文件合并为较大的文件，从而减轻存储负担。</p>
</article>
 
      

      <footer class="book-footer">
        
  




<a href="//github.com/apache/paimon/edit/1.2/docs/content/primary-key-table%5cchangelog-producer.md" style="color:black"><i class="fa fa-edit fa-fw"></i>Edit This Page</a>


 
        


<hr style="margin-top: 20px; border: 1px solid #e5e5e5;" />

<table style="border-spacing: 10px;">
    <tbody>
    <tr>
        <td colspan="2">
            Copyright &copy; 2025 The Apache Software Foundation. Apache Paimon, Paimon, and its feather logo are
            trademarks of The Apache Software Foundation.
        </td>
    </tr>
    </tbody>
</table>

      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  

<nav id="TableOfContents"><h3>On This Page <button class="toc" onclick="collapseToc()"><i class="fa fa-compress" aria-hidden="true"></i></button></h3>
  <ul>
    <li><a href="#none">None</a></li>
    <li><a href="#input">Input</a></li>
    <li><a href="#lookup">Lookup</a></li>
    <li><a href="#full-compaction">Full Compaction</a></li>
    <li><a href="#changelog-merging">Changelog Merging</a></li>
  </ul>
</nav>

 
    </aside>
    <aside class="expand-toc">
      <button class="toc" onclick="expandToc()">
        <i class="fa fa-expand" aria-hidden="true"></i>
      </button>
    </aside>
    
  </main>

  
</body>

</html>












