<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="

  Consumer ID
  #

Consumer id can help you accomplish the following two things:">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/flink/consumer-id/">
  <meta property="og:site_name" content="Apache Paimon">
  <meta property="og:title" content="Consumer ID">
  <meta property="og:description" content="Consumer ID#Consumer id can help you accomplish the following two things:">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="flink">
<title>Consumer ID | Apache Paimon</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/flink/consumer-id/">
<link rel="stylesheet" href="/book.min.d5e59cb0aa8d22a5813c62cd5e25d3d172489a369c61dc3f622ee96ae1ebb457.css" integrity="sha256-1eWcsKqNIqWBPGLNXiXT0XJImjacYdw/Yi7pauHrtFc=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.052daaa33e6f29f617942169edca8d1267adb70f5558abd179ddf86b49b548d1.js" integrity="sha256-BS2qoz5vKfYXlCFp7cqNEmettw9VWKvRed34a0m1SNE=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Apache Paimon</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0f577c58e9b3dd44e41e0b83e7c5f9ef" class="toggle"  />
    <label for="section-0f577c58e9b3dd44e41e0b83e7c5f9ef" class="flex">
      <a href="/concepts/" class="flex-auto ">Concepts</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/concepts/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/concepts/basic-concepts/" class="">Basic Concepts</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/concepts/concurrency-control/" class="">Concurrency Control</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/concepts/catalog/" class="">Catalog</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-120b07edbd4c34f9ca14c990e6d3a5c1" class="toggle"  />
    <label for="section-120b07edbd4c34f9ca14c990e6d3a5c1" class="flex">
      <a href="/concepts/rest/" class="flex-auto ">RESTCatalog</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/concepts/rest/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/concepts/rest/bear/" class="">Bear Token</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/concepts/rest/dlf/" class="">DLF Token</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/concepts/rest/rest-api/" class="">REST API</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/concepts/table-types/" class="">Table Types</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/concepts/system-tables/" class="">System Tables</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/concepts/data-types/" class="">Data Types</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c7a94b41156194ecee1e09c684d748e5" class="toggle"  />
    <label for="section-c7a94b41156194ecee1e09c684d748e5" class="flex">
      <a href="/concepts/spec/" class="flex-auto ">Specification</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/concepts/spec/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/concepts/spec/schema/" class="">Schema</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/concepts/spec/snapshot/" class="">Snapshot</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/concepts/spec/manifest/" class="">Manifest</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/concepts/spec/datafile/" class="">DataFile</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/concepts/spec/tableindex/" class="">Table Index</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/concepts/spec/fileindex/" class="">File Index</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c0d9adbd958aa78e9b5cb0511c6abe1b" class="toggle"  />
    <label for="section-c0d9adbd958aa78e9b5cb0511c6abe1b" class="flex">
      <a href="/primary-key-table/" class="flex-auto ">Table with PK</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/primary-key-table/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/primary-key-table/data-distribution/" class="">Data Distribution</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/primary-key-table/table-mode/" class="">Table Mode</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-04d66c05043a350c14fa1d446df94a79" class="toggle"  />
    <label for="section-04d66c05043a350c14fa1d446df94a79" class="flex">
      <a href="/primary-key-table/merge-engine/" class="flex-auto ">Merge Engine</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/primary-key-table/merge-engine/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/primary-key-table/merge-engine/partial-update/" class="">Partial Update</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/primary-key-table/merge-engine/aggregation/" class="">Aggregation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/primary-key-table/merge-engine/first-row/" class="">First Row</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/primary-key-table/changelog-producer/" class="">Changelog Producer</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/primary-key-table/sequence-rowkind/" class="">Sequence &amp; Rowkind</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/primary-key-table/compaction/" class="">Compaction</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/primary-key-table/query-performance/" class="">Query Performance</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-7c7495e5c54b216316cbd6cefc4966a1" class="toggle"  />
    <label for="section-7c7495e5c54b216316cbd6cefc4966a1" class="flex">
      <a href="/append-table/" class="flex-auto ">Table w/o PK</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/append-table/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/append-table/streaming/" class="">Streaming</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/append-table/query-performance/" class="">Query Performance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/append-table/update/" class="">Update</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/append-table/bucketed/" class="">Bucketed</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2bc2280284fce30dc9cfe001c4d4f308" class="toggle" checked />
    <label for="section-2bc2280284fce30dc9cfe001c4d4f308" class="flex">
      <a href="/flink/" class="flex-auto ">Engine Flink</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/flink/quick-start/" class="">Quick Start</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flink/sql-ddl/" class="">SQL DDL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flink/sql-write/" class="">SQL Write</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flink/sql-query/" class="">SQL Query</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flink/consumer-id/" class="active">Consumer ID</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flink/sql-lookup/" class="">SQL Lookup</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flink/sql-alter/" class="">SQL Alter</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flink/clone-tables/" class="">Clone Tables</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flink/procedures/" class="">Procedures</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flink/action-jars/" class="">Action Jars</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/flink/savepoint/" class="">Savepoint</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-11bc7fef43a73cd8f67282a4f805f959" class="toggle"  />
    <label for="section-11bc7fef43a73cd8f67282a4f805f959" class="flex">
      <a href="/spark/" class="flex-auto ">Engine Spark</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/spark/quick-start/" class="">Quick Start</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/spark/sql-ddl/" class="">SQL DDL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/spark/sql-functions/" class="">SQL Functions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/spark/sql-write/" class="">SQL Write</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/spark/sql-query/" class="">SQL Query</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/spark/sql-alter/" class="">SQL Alter</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/spark/auxiliary/" class="">Auxiliary</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/spark/procedures/" class="">Procedures</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c279f1a47f0df5c590de69874c1f87c3" class="toggle"  />
    <label for="section-c279f1a47f0df5c590de69874c1f87c3" class="flex">
      <a href="/ecosystem/" class="flex-auto ">Ecosystem</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/ecosystem/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/ecosystem/starrocks/" class="">StarRocks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/ecosystem/doris/" class="">Doris</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/ecosystem/hive/" class="">Hive</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/ecosystem/trino/" class="">Trino</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/ecosystem/amoro/" class="">Amoro</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e8c1a2c4fbac828568029fe095ebb072" class="toggle"  />
    <label for="section-e8c1a2c4fbac828568029fe095ebb072" class="flex">
      <a href="/cdc-ingestion/" class="flex-auto ">CDC Ingestion</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/cdc-ingestion/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/cdc-ingestion/mysql-cdc/" class="">Mysql CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/cdc-ingestion/postgres-cdc/" class="">Postgres CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/cdc-ingestion/kafka-cdc/" class="">Kafka CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/cdc-ingestion/mongo-cdc/" class="">Mongo CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/cdc-ingestion/pulsar-cdc/" class="">Pulsar CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/cdc-ingestion/debezium-bson/" class="">Debezium BSON</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-8745d48ca93ee7946abd46b8e0d32417" class="toggle"  />
    <label for="section-8745d48ca93ee7946abd46b8e0d32417" class="flex">
      <a href="/maintenance/" class="flex-auto ">Maintenance</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/maintenance/filesystems/" class="">Filesystems</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/maintenance/write-performance/" class="">Write Performance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/maintenance/dedicated-compaction/" class="">Dedicated Compaction</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/maintenance/manage-snapshots/" class="">Manage Snapshots</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/maintenance/rescale-bucket/" class="">Rescale Bucket</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/maintenance/manage-tags/" class="">Manage Tags</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/maintenance/metrics/" class="">Metrics</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/maintenance/manage-privileges/" class="">Manage Privileges</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/maintenance/manage-branches/" class="">Manage Branches</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/maintenance/manage-partitions/" class="">Manage Partitions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/maintenance/configurations/" class="">Configurations</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-855b9d3470d29baa3d9ac155f1cbb17e" class="toggle"  />
    <label for="section-855b9d3470d29baa3d9ac155f1cbb17e" class="flex">
      <a href="/program-api/" class="flex-auto ">Program API</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/program-api/flink-api/" class="">Flink API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/program-api/java-api/" class="">Java API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/program-api/catalog-api/" class="">Catalog API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/program-api/python-api/" class="">Python API</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0ffde0363b026afda7ad294c5d18c71a" class="toggle"  />
    <label for="section-0ffde0363b026afda7ad294c5d18c71a" class="flex">
      <a href="/migration/" class="flex-auto ">Migration</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/migration/migration-from-hive/" class="">Migration From Hive</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/migration/migration-from-iceberg/" class="">Migration From Iceberg</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/migration/upsert-to-partitioned/" class="">Upsert To Partitioned</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/migration/iceberg-compatibility/" class="">Iceberg Compatibility</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-85fae8232c6bd11576e7262da56e3922" class="toggle"  />
    <label for="section-85fae8232c6bd11576e7262da56e3922" class="flex">
      <a href="/project/" class="flex-auto ">Project</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/project/roadmap/" class="">Roadmap</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/project/download/" class="">Download</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/project/contributing/" class="">Contributing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/project/committer/" class="">Committer</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-263d088534eb62bb6fabbdb4626879a6" class="toggle"  />
    <label for="section-263d088534eb62bb6fabbdb4626879a6" class="flex">
      <a href="/learn-paimon/" class="flex-auto ">Learn Paimon</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/learn-paimon/understand-files/" class="">Understand Files</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Consumer ID</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#usage">Usage</a></li>
    <li><a href="#ignore-progress">Ignore Progress</a></li>
    <li><a href="#consumer-mode">Consumer Mode</a></li>
    <li><a href="#reset-consumer">Reset Consumer</a></li>
    <li><a href="#clear-consumers">Clear Consumers</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<h1 id="consumer-id">
  Consumer ID
  <a class="anchor" href="#consumer-id">#</a>
</h1>
<p>Consumer id can help you accomplish the following two things:</p>
<ol>
<li>Safe consumption: When deciding whether a snapshot has expired, Paimon looks at all the consumers of the table in
the file system, and if there are consumers that still depend on this snapshot, then this snapshot will not be
deleted by expiration.</li>
<li>Resume from breakpoint: When previous job is stopped, the newly started job can continue to consume from the previous
progress without resuming from the state.</li>
</ol>
<h2 id="usage">
  Usage
  <a class="anchor" href="#usage">#</a>
</h2>
<p>You can specify the <code>consumer-id</code> when streaming read table.</p>
<p>The consumer will prevent expiration of the snapshot. In order to prevent too many snapshots caused by mistakes,
you need to specify <code>'consumer.expiration-time'</code> to manage the lifetime of consumers.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> t <span style="color:#66d9ef">SET</span> (<span style="color:#e6db74">&#39;consumer.expiration-time&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;1 d&#39;</span>);
</span></span></code></pre></div><p>Then, restart streaming write job of this table, expiration of consumers will be triggered in writing job.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> t <span style="color:#75715e">/*+ OPTIONS(&#39;consumer-id&#39; = &#39;myid&#39;, &#39;consumer.mode&#39; = &#39;at-least-once&#39;) */</span>;
</span></span></code></pre></div><h2 id="ignore-progress">
  Ignore Progress
  <a class="anchor" href="#ignore-progress">#</a>
</h2>
<p>Sometimes, you only want the feature of &lsquo;Safe Consumption&rsquo;. You want to get a new snapshot progress when restarting the
stream consumption job , you can enable the <code>'consumer.ignore-progress'</code> option.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> t <span style="color:#75715e">/*+ OPTIONS(&#39;consumer-id&#39; = &#39;myid&#39;, &#39;consumer.ignore-progress&#39; = &#39;true&#39;) */</span>;
</span></span></code></pre></div><p>The startup of this job will retrieve the snapshot that should be read again.</p>
<h2 id="consumer-mode">
  Consumer Mode
  <a class="anchor" href="#consumer-mode">#</a>
</h2>
<p>By default, the consumption of snapshots is strictly aligned within the checkpoint to make &lsquo;Resume from breakpoint&rsquo;
feature exactly-once.</p>
<p>But in some scenarios where you don&rsquo;t need &lsquo;Resume from breakpoint&rsquo;, or you don&rsquo;t need strict &lsquo;Resume from breakpoint&rsquo;,
you can consider enabling <code>'consumer.mode' = 'at-least-once'</code> mode. This mode:</p>
<ol>
<li>Allow readers consume snapshots at different rates and record the slowest snapshot-id among all readers into the
consumer. It doesn&rsquo;t affect the checkpoint time and have good performance.</li>
<li>This mode can provide more capabilities, such as watermark alignment.</li>
</ol>
<blockquote class="book-hint ">
  
About `'consumer.mode'`, since the implementation of `exactly-once` mode and `at-least-once` mode are completely
different, the state of flink is incompatible and cannot be restored from the state when switching modes.

</blockquote>

<h2 id="reset-consumer">
  Reset Consumer
  <a class="anchor" href="#reset-consumer">#</a>
</h2>
<p>You can reset or delete a consumer with a given consumer ID and next snapshot ID and delete a consumer with a given
consumer ID. First, you need to stop the streaming task using this consumer ID, and then execute the reset consumer
action job.</p>
<p>Run the following command:</p>





<div class="book-tabs"><input 
    type="radio"
    class="toggle"
    data-tab-group="flink-tabs"
    data-tab-item="Flink SQL"
    name="tabs-reset_consumer"
    id="tabs-reset_consumer-0"
    checked="checked" 
    onclick="onSwitch('Flink SQL')"
  />
  <label for="tabs-reset_consumer-0">Flink SQL</label>
  <div class="book-tabs-content markdown-inner"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CALL</span> sys.reset_consumer(
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">`</span><span style="color:#66d9ef">table</span><span style="color:#f92672">`</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;database_name.table_name&#39;</span>, 
</span></span><span style="display:flex;"><span>   consumer_id <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;consumer_id&#39;</span>, 
</span></span><span style="display:flex;"><span>   next_snapshot_id <span style="color:#f92672">=&gt;</span> <span style="color:#f92672">&lt;</span>snapshot_id<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- No next_snapshot_id if you want to delete the consumer
</span></span></span></code></pre></div></div><input 
    type="radio"
    class="toggle"
    data-tab-group="flink-tabs"
    data-tab-item="Flink Action"
    name="tabs-reset_consumer"
    id="tabs-reset_consumer-1"
     
    onclick="onSwitch('Flink Action')"
  />
  <label for="tabs-reset_consumer-1">Flink Action</label>
  <div class="book-tabs-content markdown-inner"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&lt;FLINK_HOME&gt;/bin/flink run <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    /path/to/paimon-flink-action-1.1.1.jar <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    reset-consumer <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --warehouse &lt;warehouse-path&gt; <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --database &lt;database-name&gt; <span style="color:#ae81ff">\ </span>
</span></span><span style="display:flex;"><span>    --table &lt;table-name&gt; <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --consumer_id &lt;consumer-id&gt; <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    <span style="color:#f92672">[</span>--next_snapshot &lt;next-snapshot-id&gt;<span style="color:#f92672">]</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    <span style="color:#f92672">[</span>--catalog_conf &lt;paimon-catalog-conf&gt; <span style="color:#f92672">[</span>--catalog_conf &lt;paimon-catalog-conf&gt; ...<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## No next_snapshot if you want to delete the consumer</span>
</span></span></code></pre></div></div></div>

<h2 id="clear-consumers">
  Clear Consumers
  <a class="anchor" href="#clear-consumers">#</a>
</h2>
<p>You can clear consumers in bulk with a given including consumers and excluding consumers(accept regular expression).</p>
<p>Run the following command:</p>





<div class="book-tabs"><input 
    type="radio"
    class="toggle"
    data-tab-group="flink-tabs"
    data-tab-item="Flink SQL"
    name="tabs-clear_consumers"
    id="tabs-clear_consumers-0"
    checked="checked" 
    onclick="onSwitch('Flink SQL')"
  />
  <label for="tabs-clear_consumers-0">Flink SQL</label>
  <div class="book-tabs-content markdown-inner"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CALL</span> sys.clear_consumers(
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">`</span><span style="color:#66d9ef">table</span><span style="color:#f92672">`</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;database_name.table_name&#39;</span>, 
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">`</span>including_consumers<span style="color:#f92672">`</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;including_consumers&#39;</span>, 
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">`</span>excluding_consumers<span style="color:#f92672">`</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;excluding_consumers&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- No including_consumers if you want to clear all consumers except excluding_consumers in the table
</span></span></span></code></pre></div></div><input 
    type="radio"
    class="toggle"
    data-tab-group="flink-tabs"
    data-tab-item="Flink Action"
    name="tabs-clear_consumers"
    id="tabs-clear_consumers-1"
     
    onclick="onSwitch('Flink Action')"
  />
  <label for="tabs-clear_consumers-1">Flink Action</label>
  <div class="book-tabs-content markdown-inner"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&lt;FLINK_HOME&gt;/bin/flink run <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    /path/to/paimon-flink-action-1.1.1.jar <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    clear_consumers <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --warehouse &lt;warehouse-path&gt; <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --database &lt;database-name&gt; <span style="color:#ae81ff">\ </span>
</span></span><span style="display:flex;"><span>    --table &lt;table-name&gt; <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    <span style="color:#f92672">[</span>--including_consumers &lt;including-consumers&gt;<span style="color:#f92672">]</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    <span style="color:#f92672">[</span>--excluding_consumers &lt;excluding-consumers&gt;<span style="color:#f92672">]</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    <span style="color:#f92672">[</span>--catalog_conf &lt;paimon-catalog-conf&gt; <span style="color:#f92672">[</span>--catalog_conf &lt;paimon-catalog-conf&gt; ...<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e">## No including_consumers if you want to clear all consumers except excluding_consumers in the table</span>
</span></span></code></pre></div></div></div>

</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#usage">Usage</a></li>
    <li><a href="#ignore-progress">Ignore Progress</a></li>
    <li><a href="#consumer-mode">Consumer Mode</a></li>
    <li><a href="#reset-consumer">Reset Consumer</a></li>
    <li><a href="#clear-consumers">Clear Consumers</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












